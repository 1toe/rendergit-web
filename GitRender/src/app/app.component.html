<div class="app-shell" [class.loading]="loading()">
  <header class="topbar">
    <h1 class="logo">RenderGit</h1>
    <form class="repo-form" (submit)="onSubmit()" novalidate>
      <input name="repo" [(ngModel)]="repoUrl" required placeholder="https://github.com/usuario/repositorio" aria-label="URL del repositorio" />
      <button type="submit" [disabled]="loading() || !repoUrl">{{ loading() ? 'Procesando‚Ä¶' : 'Procesar' }}</button>
    </form>
  </header>

  <div class="layout" *ngIf="!error()">
    <aside class="sidebar" *ngIf="result() as r">
      <div class="sidebar-section">
        <label class="filter-label">Filtrar</label>
        <input type="text" [(ngModel)]="filter()" placeholder="Filtrar archivos" />
      </div>
      <div class="sidebar-section meta" *ngIf="r">
        <div><strong>Repo:</strong> <a [href]="'https://github.com/' + r.owner + '/' + r.repo" target="_blank">{{ r.owner }}/{{ r.repo }}</a></div>
        <div><strong>Commit:</strong> {{ r.commitSha.slice(0,8) }}</div>
        <div class="counts"><strong>Total:</strong> {{ r.files.length }} ¬∑ <strong>Renderizados:</strong> {{ r.rendered.length }}</div>
      </div>
      <nav class="sidebar-section toc" *ngIf="r">
        <h2>Contenido ({{ filteredToc().length }})</h2>
        <ul>
          <li *ngFor="let t of filteredToc()"><a [href]="'#file-' + t.anchor">{{ t.rel }}</a> <span class="size">{{ bytesHuman(t.size) }}</span></li>
        </ul>
      </nav>
      <div class="sidebar-section switches" *ngIf="r">
        <button type="button" class="switch" [class.active]="viewMode() === 'human'" (click)="switchView('human')">üë§ Humano</button>
        <button type="button" class="switch" [class.active]="viewMode() === 'llm'" (click)="switchView('llm')">ü§ñ LLM</button>
      </div>
    </aside>

    <main class="content" *ngIf="result() as r">
      <section class="intro" *ngIf="!r.rendered.length && !loading()">
        <p>Ingresa una URL p√∫blica de GitHub para aplanar el repositorio en una sola p√°gina navegable y una vista CXML apta para LLMs.</p>
      </section>

      <section class="loading-state" *ngIf="loading()">
        <div class="spinner" aria-hidden="true"></div>
        <p>Procesando repositorio‚Ä¶</p>
      </section>

      <ng-container *ngIf="!loading()">
        <section *ngIf="viewMode() === 'human'" class="human-view">
          <h2>√Årbol de directorios</h2>
          <pre class="tree">{{ r.treeText }}</pre>
          <section class="skips">
            <h3>Omitidos</h3>
            <details *ngIf="r.skippedBinary.length" open><summary>Binarios ({{ r.skippedBinary.length }})</summary>
              <ul><li *ngFor="let f of r.skippedBinary">{{ f.path }} <span class="size">{{ bytesHuman(f.size) }}</span></li></ul>
            </details>
            <details *ngIf="r.skippedLarge.length" open><summary>Grandes ({{ r.skippedLarge.length }})</summary>
              <ul><li *ngFor="let f of r.skippedLarge">{{ f.path }} <span class="size">{{ bytesHuman(f.size) }}</span></li></ul>
            </details>
          </section>
          <section class="files">
            <article *ngFor="let f of r.rendered" class="file" [attr.id]="'file-' + slugify(f.path)">
              <h3>{{ f.path }} <span class="size">({{ bytesHuman(f.size) }})</span></h3>
              <div class="file-body" [innerHTML]="f.isMarkdown ? (f.content | markdown) : ('<pre><code>' + (f.content || '') + '</code></pre>')"></div>
              <a class="back-top" href="#top" aria-label="Volver al inicio">‚Üë</a>
            </article>
          </section>
        </section>
        <section *ngIf="viewMode() === 'llm'" class="llm-view">
          <h2>Vista LLM (CXML)</h2>
          <textarea readonly class="cxml" (focus)="$event.target.select()">{{ r.cxmlText }}</textarea>
          <p class="hint">Consejo: Ctrl + A luego Ctrl + C para copiar todo.</p>
        </section>
      </ng-container>
    </main>
  </div>

  <div class="error" *ngIf="error()"><strong>Error:</strong> {{ error() }}</div>
</div>
